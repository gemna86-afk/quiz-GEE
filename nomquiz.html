<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz G√©omatique M2 - Analyse Multicrit√®re (10 min)</title>
    <!-- Chargement de Tailwind CSS pour un style moderne et responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Configuration de la police Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Gris tr√®s clair */
        }
        /* Styles pour les boutons d'options */
        .option-button {
            transition: all 0.2s;
            min-height: 4rem;
            /* Flex pour centrer le texte des options */
            display: flex;
            align-items: center;
            text-align: left;
        }
        .option-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            background-color: #f1f5f9; /* Slate-100 */
        }
        /* Styles pour les r√©ponses correctes/incorrectes apr√®s la fin du quiz */
        .correct {
            background-color: #d1fae5; /* Vert 100 */
            border-color: #34d399; /* Vert 400 */
        }
        .incorrect {
            background-color: #fee2e2; /* Rouge 100 */
            border-color: #f87171; /* Rouge 400 */
        }
        /* Style pour l'alerte/rationale */
        .rationale-text {
            border-left: 4px solid;
            padding-left: 1rem;
        }
        /* Animation simple pour l'ic√¥ne de chargement */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .spinner {
            border-top-color: #1e40af;
            animation: spin 1s ease-in-out infinite;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center">

    <div id="app" class="w-full max-w-4xl bg-white shadow-xl rounded-xl p-6 md:p-10 border border-gray-100">
        <!-- Le contenu sera rendu ici par JavaScript -->
    </div>

    <script>
        // Le contenu du quiz est extrait et nettoy√© du JSON de l'artefact pr√©c√©dent.
        const quizData = [
            {
                question: "Quel est l‚Äôobjectif principal de l‚Äô√©tape de standardisation ou de normalisation des facteurs dans le processus d'Analyse Multicrit√®re (AMC)?",
                options: [
                    { text: "D√©terminer l'importance relative de chaque crit√®re gr√¢ce √† la m√©thode AHP.", isCorrect: false, rationale: "L'importance relative des crit√®res est d√©termin√©e lors de l'√©tape de pond√©ration, souvent via des m√©thodes comme l'AHP, et non la normalisation." },
                    { text: "Ramener les valeurs des crit√®res √† une √©chelle commune pour une comparaison √©quitable.", isCorrect: true, rationale: "La normalisation est essentielle pour rendre comparables des variables h√©t√©rog√®nes (m√®tres, degr√©s, pourcentage) en les exprimant sur un r√©f√©rentiel d'aptitude unique." },
                    { text: "V√©rifier la coh√©rence des jugements des experts √† l'aide du Ratio de Coh√©rence (RC).", isCorrect: false, rationale: "Le Ratio de Coh√©rence est utilis√© lors de la pond√©ration (AHP) pour √©valuer la fiabilit√© des comparaisons par paire, et non pendant la normalisation." },
                    { text: "Combiner les cartes de facteurs et les poids pour g√©n√©rer la carte de d√©cision finale.", isCorrect: false, rationale: "La combinaison des crit√®res normalis√©s et pond√©r√©s est r√©alis√©e lors de l'√©tape d'agr√©gation, qui suit la normalisation." }
                ]
            },
            {
                question: "Dans le cadre du Processus Hi√©rarchique Analytique (AHP), que repr√©sente la m√©thode de comparaison par paire (pairwise comparison) d√©velopp√©e par Saaty (1977)?",
                options: [
                    { text: "Une technique d‚Äôagr√©gation lin√©aire pond√©r√©e des crit√®res.", isCorrect: false, rationale: "La comparaison par paire est une m√©thode de pond√©ration pour √©tablir les poids des crit√®res, pas une m√©thode d'agr√©gation." },
                    { text: "Une m√©thode pour r√©√©valuer les valeurs brutes des facteurs en scores d'aptitude de 0 √† 1.", isCorrect: false, rationale: "La r√©√©valuation des valeurs brutes en scores d'aptitude est l'objectif de la normalisation (ou standardisation) des facteurs." },
                    { text: "Une technique pour d√©terminer le poids relatif de chaque crit√®re en les comparant deux √† deux sur une √©chelle de 1 √† 9.", isCorrect: true, rationale: "La m√©thode AHP utilise la comparaison par paire pour construire une matrice permettant de d√©river le vecteur propre et les poids associ√©s √† chaque crit√®re." },
                    { text: "Un outil de validation pour cr√©er des classes de vuln√©rabilit√© sur la carte finale.", isCorrect: false, rationale: "La validation et la classification des r√©sultats se font apr√®s la phase de pond√©ration et d'agr√©gation." }
                ]
            },
            {
                question: "Selon l'√©chelle fondamentale de Saaty, quelle note est attribu√©e lorsque le crit√®re i\u2081 a 'beaucoup plus d‚Äôimportance' que le crit√®re i\u2082 ?",
                options: [
                    { text: "3", isCorrect: false, rationale: "La note 3 correspond √† 'l√©g√®rement plus d‚Äôimportance'." },
                    { text: "5", isCorrect: false, rationale: "La note 5 correspond √† 'plus d‚Äôimportance'." },
                    { text: "7", isCorrect: true, rationale: "La note 7 signifie que le crit√®re i\u2081 a 'beaucoup plus d‚Äôimportance' que i\u2082." },
                    { text: "9", isCorrect: false, rationale: "La note 9 correspond √† l'importance 'absolue' ou 'priorit√© sur'." }
                ]
            },
            {
                question: "Dans la v√©rification de la consistance des jugements AHP, quel est le seuil maximal acceptable pour le Ratio de Coh√©rence (RC)?",
                options: [
                    { text: "RC < 0,01", isCorrect: false, rationale: "Ce seuil est trop strict; le seuil de 0,01 est souvent synonyme de coh√©rence quasi parfaite." },
                    { text: "RC < 0,10", isCorrect: true, rationale: "Selon Saaty, un RC inf√©rieur √† 0,10 indique une coh√©rence acceptable des comparaisons par paire, et le processus peut continuer." },
                    { text: "RC < 0,50", isCorrect: false, rationale: "Un RC de 0,50 serait consid√©r√© comme une incoh√©rence significative et n√©cessiterait une r√©vision des jugements." },
                    { text: "RC = 1,00", isCorrect: false, rationale: "Un RC √©gal √† 1,00 signifierait une incoh√©rence majeure, car il est recherch√© un RC proche de z√©ro." }
                ]
            },
            {
                question: "Quelle est la principale diff√©rence entre la standardisation des facteurs par 'Reclassification rigide' (Classification simple) et par 'Fonction d‚ÄôAppartenance Floue' (Fuzzy Membership)?",
                options: [
                    { text: "La Reclassification rigide est utilis√©e pour les donn√©es raster, tandis que les Fonctions Floues sont r√©serv√©es aux donn√©es vectorielles.", isCorrect: false, rationale: "Les deux m√©thodes peuvent √™tre appliqu√©es aux donn√©es raster, selon le mod√®le d'aptitude utilis√©." },
                    { text: "La Reclassification rigide g√®re l'incertitude et les zones de transition, alors que les Fonctions Floues imposent des classes binaires (aptitude 0 ou 1).", isCorrect: false, rationale: "C'est l'inverse : les fonctions floues int√®grent l'incertitude et les transitions douces, tandis que la reclassification est rigide (valeurs discr√®tes)." },
                    { text: "La Reclassification rigide attribue des valeurs discr√®tes (ex: 1, 2, 3) sans transition, alors que les Fonctions Floues attribuent un degr√© d‚Äôappartenance continu entre 0 et 1.", isCorrect: true, rationale: "La force des fonctions floues est de mod√©liser des transitions progressives, contrairement aux seuils nets de la reclassification simple." },
                    { text: "La Reclassification rigide est utilis√©e pour la pond√©ration, et les Fonctions Floues pour l'agr√©gation.", isCorrect: false, rationale: "Les deux sont des m√©thodes de normalisation des facteurs, pas des m√©thodes de pond√©ration ou d'agr√©gation." }
                ]
            },
            {
                question: "Laquelle de ces √©chelles est couramment utilis√©e en AMC-SIG pour exprimer les scores normalis√©s sur une base d'aptitude continue, notamment avec des poids flous?",
                options: [
                    { text: "√âchelle discr√®te de 1 √† 9 (√©chelle de Saaty).", isCorrect: false, rationale: "L'√©chelle de 1 √† 9 est l'√©chelle de Saaty utilis√©e pour la pond√©ration (AHP), et non pour la normalisation des scores d'aptitude." },
                    { text: "√âchelle continue de 0 √† 1.", isCorrect: true, rationale: "L'√©chelle continue de 0 √† 1 est tr√®s courante pour repr√©senter le degr√© d'appartenance (poids flous) ou les scores d'aptitude normalis√©s dans la plupart des logiciels SIG avanc√©s." },
                    { text: "√âchelle de 0 √† 1000 m√®tres.", isCorrect: false, rationale: "Cette √©chelle est une unit√© de mesure brute (distance), qui doit √™tre normalis√©e pour √™tre utilisable en AMC." },
                    { text: "√âchelle de 0 √† 255.", isCorrect: false, rationale: "L'√©chelle de 0 √† 255 est un codage sur 8 bits, qui peut √™tre utilis√© pour la classification, mais l'√©chelle de 0 √† 1 est plus typique pour la pond√©ration floue continue." }
                ]
            },
            {
                question: "Pourquoi l'approche AMC-SIG est-elle consid√©r√©e comme essentielle dans la r√©solution des probl√®mes de d√©cision spatiale complexes?",
                options: [
                    { text: "Parce qu'elle permet de remplacer compl√®tement le jugement humain par un algorithme purement objectif.", isCorrect: false, rationale: "L'AMC vise √† 'aider' √† la prise de d√©cision en int√©grant le jugement humain (pr√©f√©rences, pond√©rations) dans un cadre structur√©, sans le remplacer totalement." },
                    { text: "Parce qu'elle permet de simplifier les probl√®mes de d√©cision en n'utilisant qu'un seul crit√®re √† la fois.", isCorrect: false, rationale: "L'AMC est par d√©finition con√ßue pour g√©rer la multiplicit√© et la diversit√© des crit√®res (crit√®res multiples) qui sont souvent conflictuels." },
                    { text: "Parce qu'elle est capable de g√©rer une multiplicit√© de crit√®res vari√©s (quantitatifs ou qualitatifs) et les objectifs divergents de multiples acteurs.", isCorrect: true, rationale: "L'AMC permet de structurer un probl√®me complexe en int√©grant divers crit√®res et en cherchant un compromis satisfaisant entre les pr√©f√©rences des diff√©rentes parties prenantes." },
                    { text: "Parce qu'elle est uniquement bas√©e sur la reclassification des donn√©es p√©dologiques et hydrologiques.", isCorrect: false, rationale: "L'AMC-SIG utilise un large √©ventail de crit√®res g√©ographiques et socio-√©conomiques; elle n'est pas limit√©e √† ces seules disciplines." }
                ]
            },
            {
                question: "Lequel des √©l√©ments suivants est d√©fini comme 'l'importance relative attribu√©e √† chaque crit√®re dans le mod√®le, dont le total doit g√©n√©ralement √™tre √©gal √† 100% ou 1'?",
                options: [
                    { text: "Crit√®re", isCorrect: false, rationale: "Un crit√®re est un facteur pris en compte dans l'analyse (ex: pente, co√ªt), pas son niveau d'influence." },
                    { text: "Degr√© de vuln√©rabilit√©", isCorrect: false, rationale: "Le degr√© de vuln√©rabilit√© est le niveau de sensibilit√© ou de risque repr√©sent√© par une valeur d'un crit√®re (ex: For√™t = faible vuln√©rabilit√©), pas son poids g√©n√©ral dans l'analyse." },
                    { text: "Classe de vuln√©rabilit√©", isCorrect: false, rationale: "Les classes de vuln√©rabilit√© sont les cat√©gories de la carte finale (ex: faible, moyen, fort), pas l'importance relative d'un facteur." },
                    { text: "Poids", isCorrect: true, rationale: "Le poids est la valeur num√©rique (coefficient de pond√©ration) qui exprime l'importance relative d'un facteur dans l'√©quation d'agr√©gation, o√π la somme des poids vaut 1." }
                ]
            },
            {
                question: "Dans quel contexte une 'Fonction d‚ÄôAppartenance Floue en forme de J' est-elle la plus appropri√©e pour la standardisation d'un facteur?",
                options: [
                    { text: "Quand l'influence du facteur augmente proportionnellement √† sa valeur (Lin√©aire).", isCorrect: false, rationale: "Ceci d√©crit une fonction d'appartenance de type lin√©aire (croissante) ou sigmo√Øde (forme en 'S' avec seuil progressif)." },
                    { text: "Quand l'influence du facteur est la plus forte d√®s les premi√®res valeurs, puis son effet sature rapidement (J-Shape).", isCorrect: true, rationale: "La fonction en 'J' est adapt√©e aux facteurs dont l'effet est tr√®s important et imm√©diat (ex: proximit√© imm√©diate d'un √©l√©ment) et qui saturent ensuite." },
                    { text: "Quand le facteur est tr√®s favorable au milieu de l'intervalle de valeurs, et d√©favorable aux deux extr√©mit√©s.", isCorrect: false, rationale: "Ceci d√©crirait plut√¥t une fonction d'appartenance en forme de cloche (gaussienne) ou triangulaire ('U' invers√©)." },
                    { text: "Quand le facteur devient significatif √† partir d‚Äôun seuil, avec une transition douce ('S' shape).", isCorrect: false, rationale: "Ceci correspond √† une fonction d'appartenance de type sigmo√Øde ou en 'S'." }
                ]
            },
            {
                question: "Selon les √©tapes de l'AMC-SIG, quelle op√©ration intervient imm√©diatement apr√®s la Pond√©ration des crit√®res (AHP, Ranking, etc.)?",
                options: [
                    { text: "Fixer l'objectif et d√©finir le probl√®me.", isCorrect: false, rationale: "C'est la premi√®re √©tape du processus AMC, bien avant la pond√©ration." },
                    { text: "Normaliser les scores des facteurs/crit√®res.", isCorrect: false, rationale: "La normalisation doit √™tre faite avant la pond√©ration pour s'assurer que les crit√®res √† pond√©rer sont sur une m√™me √©chelle." },
                    { text: "Valider/v√©rifier le r√©sultat final.", isCorrect: false, rationale: "La validation est la toute derni√®re √©tape de l'analyse, apr√®s l'agr√©gation." },
                    { text: "Agr√©ger les crit√®res (Combinaison Pond√©r√©e).", isCorrect: true, rationale: "Une fois les facteurs normalis√©s et les poids des crit√®res d√©termin√©s, l'√©tape suivante est l'agr√©gation pour calculer l'aptitude finale (Combinaison Pond√©r√©e)." }
                ]
            }
        ];

        // --- AJOUT : Email du professeur ---
        // !!! IMPORTANT : Modifiez cette adresse e-mail par la v√¥tre
        const INSTRUCTOR_EMAIL = 'votre.email@exemple.com'; 
        // ---------------------------------

        // --- √âtat Global de l'Application ---
        let state = {
            quizState: 'start', // 'start', 'active', 'finished'
            currentQuestionIndex: 0,
            score: 0,
            answers: new Array(quizData.length).fill(null), // Stocke l'index de l'option s√©lectionn√©e (ou null)
            timeLeft: 10 * 60, // 10 minutes en secondes
            timerInterval: null,
            participantName: '' // Stocke le nom du participant
        };

        const appElement = document.getElementById('app');
        const MAX_TIME = 10 * 60; // 10 minutes

        // --- Fonctions de Gestion du Temps ---

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function startTimer() {
            if (state.timerInterval) clearInterval(state.timerInterval);

            state.timerInterval = setInterval(() => {
                state.timeLeft--;
                render();

                if (state.timeLeft <= 0) {
                    clearInterval(state.timerInterval);
                    endQuiz(true); // Termine √† cause du temps √©coul√©
                }
            }, 1000);
        }

        function stopTimer() {
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }
        }

        // --- Fonctions de Gestion du Quiz ---

        function startQuiz() {
            // AJOUT : Validation du nom
            const nameInput = document.getElementById('participantNameInput');
            const errorEl = document.getElementById('nameError');
            const name = nameInput.value.trim();

            if (name === '') {
                errorEl.textContent = 'Veuillez entrer votre nom pour commencer.';
                errorEl.classList.remove('hidden');
                nameInput.focus();
                return;
            }
            // Fin AJOUT
            
            errorEl.classList.add('hidden'); // Cacher l'erreur si c'est bon
            state.participantName = name; // Sauvegarder le nom
            state.quizState = 'active';
            state.currentQuestionIndex = 0;
            state.score = 0;
            state.answers = new Array(quizData.length).fill(null);
            state.timeLeft = MAX_TIME;
            startTimer();
            render();
        }

        function selectAnswer(questionIndex, optionIndex) {
            // Si le quiz n'est pas actif ou la question est d√©j√† r√©pondue, ignorer
            if (state.quizState !== 'active' || state.answers[questionIndex] !== null) return;

            state.answers[questionIndex] = optionIndex;
            
            // Calculer le score imm√©diatement
            updateScore();
            
            // D√©sactiver tous les boutons IMM√âDIATEMENT pour √©viter les double-clics
            const allButtons = appElement.querySelectorAll('.option-button');
            allButtons.forEach((btn, idx) => {
                btn.disabled = true;
                btn.classList.add('opacity-80', 'cursor-not-allowed');
                btn.classList.remove('hover:bg-gray-100');

                // Appliquer le style de s√©lection au bouton cliqu√©
                if (idx === optionIndex) {
                    btn.classList.add('transform', 'scale-[1.01]', 'ring-4', 'ring-blue-300', 'bg-blue-200', 'border-blue-600', 'text-blue-800');
                    btn.classList.remove('bg-white', 'border-gray-300'); // Retirer l'ancien style
                }
            });

            // Passer √† la question suivante apr√®s un court d√©lai pour voir la s√©lection
            setTimeout(() => {
                nextQuestion();
            }, 300); // D√©lai pour voir la s√©lection
        }
        
        function updateScore() {
            let currentScore = 0;
            state.answers.forEach((selectedOptionIndex, qIndex) => {
                if (selectedOptionIndex !== null) {
                    const question = quizData[qIndex];
                    if (question.options[selectedOptionIndex].isCorrect) {
                        currentScore++;
                    }
                }
            });
            state.score = currentScore;
        }

        function nextQuestion() {
            if (state.currentQuestionIndex < quizData.length - 1) {
                state.currentQuestionIndex++;
                render();
            } else {
                endQuiz(false); // Termine normalement
            }
        }
        
        // Expose showQuestion globally for navigation in results (though not used in this iteration)
        window.showQuestion = function(index) {
            state.currentQuestionIndex = index;
            render();
        }

        function endQuiz(timeUp) {
            stopTimer();
            state.quizState = 'finished';
            // Calcul final du score bas√© sur les r√©ponses stock√©es
            updateScore();
            render();
            
            // Afficher un message de fin de temps
            if (timeUp) {
                // Utiliser un modal personnalis√© au lieu d'alert()
                const modal = document.getElementById('time-up-modal');
                if (modal) {
                    modal.classList.remove('hidden');
                    // Cacher le modal apr√®s 5 secondes
                    setTimeout(() => modal.classList.add('hidden'), 5000); 
                }
            }
        }

        // --- SUPPRIM√â : Nouvelle fonction pour r√©initialiser le quiz
        // function resetToStart() { ... }

        // Exposer les fonctions importantes au scope global pour les `onclick`
        window.startQuiz = startQuiz;
        window.selectAnswer = selectAnswer;
        window.endQuiz = endQuiz;
        // SUPPRIM√â : window.resetToStart = resetToStart;


        // --- Fonctions de Rendu des √âcrans ---

        function renderStartScreen() {
            appElement.innerHTML = `
                <div class="text-center">
                    <h1 class="text-3xl font-extrabold text-blue-800 mb-4">Quiz G√©omatique Master 2</h1>
                    <p class="text-xl text-gray-600 mb-6">Analyse Multicrit√®re et SIG (AMC-SIG)</p>
                    
                    <div class="bg-blue-50 border border-blue-200 p-6 rounded-xl shadow-md inline-block max-w-lg mx-auto">
                        <p class="text-gray-700 text-lg mb-4">Ce quiz contient ${quizData.length} questions et teste vos connaissances sur les concepts fondamentaux de l'AMC et de l'AHP.</p>
                        
                        <!-- AJOUT : Champ pour le nom -->
                        <div class="mb-4 text-left">
                            <label for="participantNameInput" class="block text-lg font-semibold text-gray-700 mb-2">Votre Nom Complet :</label>
                            <input type="text" id="participantNameInput" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500" placeholder="Ex: Jean Dupont" value="${state.participantName}">
                            <p id="nameError" class="text-red-500 text-sm mt-1 hidden"></p>
                        </div>
                        <!-- Fin AJOUT -->

                        <p class="text-2xl font-bold text-red-600 mb-6 flex items-center justify-center">
                            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            Temps Limite : 10 minutes
                        </p>
                        <button onclick="startQuiz()" class="w-full py-3 px-6 bg-blue-600 text-white font-semibold rounded-lg shadow-xl hover:bg-blue-700 transition duration-300 transform hover:scale-[1.02]">
                            Commencer le Quiz
                        </button>
                    </div>
                </div>
            `;
        }

        function renderActiveQuiz() {
            const qIndex = state.currentQuestionIndex;
            const question = quizData[qIndex];
            const totalQuestions = quizData.length;
            // La progression doit prendre en compte la question en cours + les questions r√©pondues si l'on est √† la fin.
            const answeredCount = state.answers.filter(a => a !== null).length;
            const progress = (answeredCount / totalQuestions) * 100;
            const selectedOption = state.answers[qIndex];

            // Rendu de la minuterie
            const timeFormatted = formatTime(state.timeLeft);
            const timerColor = state.timeLeft <= 60 ? 'bg-red-500' : 'bg-blue-600';
            const timerText = state.timeLeft <= 60 ? 'text-white font-bold' : 'text-white';

            // Contenu HTML principal du quiz
            appElement.innerHTML = `
                <!-- Modale Alerte Temps √âcoul√© -->
                <div id="time-up-modal" class="fixed inset-0 z-50 bg-black bg-opacity-70 flex items-center justify-center hidden backdrop-blur-sm transition-opacity duration-300">
                    <div class="bg-red-600 text-white p-10 rounded-xl shadow-2xl text-center transform scale-105 animate-pulse border-4 border-white">
                        <p class="text-3xl font-extrabold mb-2">üî¥ TEMPS √âCOUL√â !</p>
                        <p class="text-lg">Le quiz est termin√©. Affichage des r√©sultats...</p>
                    </div>
                </div>

                <!-- En-t√™te du Quiz (Minuteur & Progression) -->
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 p-4 border-b-4 border-blue-500 bg-blue-50 rounded-lg shadow-inner">
                    <div class="order-2 md:order-1 w-full md:w-auto text-center md:text-left">
                         <p class="text-xl font-semibold text-gray-700 mb-2">Question ${qIndex + 1} / ${totalQuestions}</p>
                         <div class="w-full bg-gray-300 rounded-full h-3">
                             <div class="bg-blue-500 h-3 rounded-full transition-all duration-700" style="width: ${progress}%;"></div>
                         </div>
                         <p class="text-sm text-gray-500 mt-1">Progression des r√©ponses</p>
                    </div>
                    
                    <div class="order-1 md:order-2 flex items-center space-x-2 mb-4 md:mb-0">
                        <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="text-2xl ${timerText} px-4 py-1 rounded-xl ${timerColor} shadow-lg transition duration-500 min-w-[5rem] text-center">${timeFormatted}</span>
                    </div>
                </div>

                <!-- Corps de la Question -->
                <div class="mt-8">
                    <p class="text-2xl font-bold text-gray-800 mb-6 p-3 bg-gray-50 rounded-lg shadow-sm">${question.question}</p>
                    <div class="space-y-4">
                        ${question.options.map((option, oIndex) => {
                            const isSelected = selectedOption === oIndex;
                            const buttonClass = isSelected 
                                ? 'bg-blue-200 border-blue-600 shadow-xl ring-4 ring-blue-300 text-blue-800' 
                                : 'bg-white border-gray-300 hover:bg-gray-100';
                            
                            return `
                                <button
                                    onclick="selectAnswer(${qIndex}, ${oIndex})"
                                    class="option-button w-full text-left p-4 rounded-xl border-4 shadow-md ${buttonClass}
                                        text-gray-700 disabled:opacity-80 disabled:cursor-not-allowed"
                                    ${selectedOption !== null ? 'disabled' : ''}
                                >
                                    <span class="font-extrabold mr-3 text-lg">${String.fromCharCode(65 + oIndex)}.</span> ${option.text}
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>

                <!-- Bas de page -->
                <div class="mt-8 pt-4 border-t border-gray-200 flex flex-col md:flex-row justify-between items-center space-y-3 md:space-y-0">
                    <p class="text-sm text-gray-500">Choisissez une seule option. Le passage √† la question suivante est automatique.</p>
                    <button onclick="endQuiz(false)" class="py-2 px-6 bg-red-600 text-white font-semibold rounded-lg shadow-lg hover:bg-red-700 transition duration-300 transform hover:scale-[1.02]">
                        Terminer le Quiz et Voir les R√©sultats
                    </button>
                </div>
            `;
        }

        function renderResultsScreen() {
            const totalQuestions = quizData.length;
            const percentage = ((state.score / totalQuestions) * 100).toFixed(1);
            const gradeText = state.score >= Math.ceil(totalQuestions * 0.7) ? 'F√©licitations !' : '√Ä revoir...';
            const gradeColor = state.score >= Math.ceil(totalQuestions * 0.7) ? 'text-green-600' : 'text-red-600';
            const timeTaken = MAX_TIME - state.timeLeft;
            const timeTakenFormatted = formatTime(timeTaken);

            // AJOUT : Logique pour le lien mailto
            const subject = `R√©sultats Quiz AMC - ${state.participantName}`;
            const body = `Bonjour,
\nVoici mes r√©sultats pour le Quiz G√©omatique AMC :
\nNom : ${state.participantName}
Score : ${state.score} / ${totalQuestions}
Pourcentage : ${percentage}%
Temps utilis√© : ${timeTakenFormatted}
\nMerci.`;
            const mailtoLink = `mailto:${INSTRUCTOR_EMAIL}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            // Fin AJOUT

            // Structure du r√©sum√©
            let resultsHTML = `
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-extrabold text-blue-800 mb-2">R√©sultats du Quiz</h1>
                    <p class="text-xl text-gray-600 mb-6">${gradeText}</p>
                    
                    <!-- Cartes de R√©sultat - Rendu Responsive -->
                    <div class="flex flex-wrap justify-center gap-4 bg-blue-50 rounded-xl p-6 shadow-xl border border-blue-200">
                        <!-- Carte 1: Score -->
                        <div class="w-full sm:w-auto p-4 bg-white rounded-lg shadow-md flex flex-col items-center">
                            <p class="text-5xl font-bold ${gradeColor}">${state.score}/${totalQuestions}</p>
                            <p class="text-sm text-gray-500 mt-1">Bonnes R√©ponses</p>
                        </div>
                        <!-- Carte 2: Pourcentage -->
                        <div class="w-full sm:w-auto p-4 bg-white rounded-lg shadow-md flex flex-col items-center">
                            <p class="text-5xl font-bold text-gray-800">${percentage}%</p>
                            <p class="text-sm text-gray-500 mt-1">Pourcentage</p>
                        </div>
                        <!-- Carte 3: Temps -->
                        <div class="w-full sm:w-auto p-4 bg-white rounded-lg shadow-md flex flex-col items-center">
                            <p class="text-5xl font-bold text-gray-800">${timeTakenFormatted}</p>
                            <p class="text-sm text-gray-500 mt-1">Temps Utilis√©</p>
                        </div>
                    </div>
                </div>

                <h2 class="text-2xl font-extrabold text-gray-800 border-b-2 border-gray-300 pb-2 mb-6">Correction D√©taill√©e</h2>
                <div class="space-y-8">
            `;

            // Affichage d√©taill√© de chaque question
            quizData.forEach((question, qIndex) => {
                const selectedOptionIndex = state.answers[qIndex];
                // Consid√©rer la question comme correcte m√™me si la r√©ponse est null mais l'index correct est null (ce qui ne devrait pas arriver dans ce quiz)
                const isCorrect = selectedOptionIndex !== null && question.options[selectedOptionIndex].isCorrect;
                const cardColor = isCorrect ? 'border-green-600' : 'border-red-600';
                const cardBg = isCorrect ? 'bg-green-50' : 'bg-red-50';
                const icon = isCorrect 
                    ? `<svg class="w-6 h-6 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>`
                    : `<svg class="w-6 h-6 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path></svg>`;

                resultsHTML += `
                    <div class="p-6 border-4 rounded-xl ${cardColor} ${cardBg} shadow-lg">
                        <div class="flex items-start mb-4">
                            ${icon}
                            <p class="text-lg font-bold text-gray-800">Question ${qIndex + 1} : ${question.question}</p>
                        </div>
                        
                        <div class="ml-4 space-y-3">
                            ${question.options.map((option, oIndex) => {
                                let optionClass = 'p-3 rounded-lg border';
                                let statusIcon = '';
                                
                                if (option.isCorrect) {
                                    optionClass += ' correct font-bold border-green-500 bg-green-200 text-green-900 shadow-inner'; // Toujours mettre en √©vidence la bonne r√©ponse
                                    statusIcon = `<svg class="w-5 h-5 ml-auto text-green-700" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>`;
                                } else if (oIndex === selectedOptionIndex) {
                                    optionClass += ' incorrect font-semibold border-red-500 bg-red-200 text-red-900 shadow-inner'; // R√©ponse du candidat (si incorrecte)
                                    statusIcon = `<svg class="w-5 h-5 ml-auto text-red-700" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>`;
                                } else {
                                    optionClass += ' text-gray-600 border-gray-200 bg-white';
                                }
                                return `<div class="${optionClass} flex items-center">
                                            <span class="font-extrabold mr-3">${String.fromCharCode(65 + oIndex)}.</span> ${option.text}
                                            ${statusIcon}
                                        </div>`;
                            }).join('')}
                        </div>
                        
                        <!-- Rationale -->
                        <div class="mt-5 p-4 rationale-text border-green-600 bg-green-100 rounded-lg shadow-md">
                            <p class="font-extrabold text-green-900 text-lg mb-1">Explication :</p>
                            <p class="text-gray-700">${question.options.find(opt => opt.isCorrect).rationale}</p>
                        </div>
                    </div>
                `;
            });

            resultsHTML += `
                </div>
                
                <!-- AJOUT : Section d'envoi des r√©sultats -->
                <div class="mt-10 pt-6 border-t border-gray-300 bg-gray-50 p-6 rounded-lg shadow-inner text-center">
                    <h3 class="text-xl font-bold text-gray-800 mb-3">Envoyer vos r√©sultats</h3>
                    <p class="text-gray-600 mb-5">Cliquez sur le bouton ci-dessous pour envoyer vos r√©sultats par e-mail √† votre professeur. Ceci est votre seule tentative.</p>
                    <a href="${mailtoLink}" 
                       target="_blank" 
                       class="inline-block py-3 px-8 bg-green-600 text-white font-semibold rounded-lg shadow-xl hover:bg-green-700 transition duration-300 transform hover:scale-[1.02]">
                        <svg class="w-5 h-5 inline-block mr-2 -mt-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg>
                        Envoyer mes r√©sultats
                    </a>
                </div>
                <!-- Fin AJOUT -->

                <!-- SUPPRIM√â : Bouton de Recommencer -->
            `;
            
            appElement.innerHTML = resultsHTML;
        }

        function render() {
            switch (state.quizState) {
                case 'start':
                    renderStartScreen();
                    break;
                case 'active':
                    renderActiveQuiz();
                    break;
                case 'finished':
                    renderResultsScreen();
                    break;
            }
        }

        // Initialisation - D√©marrer le rendu au chargement complet de la page
        document.addEventListener('DOMContentLoaded', render);
    </script>
</body>
</html>
